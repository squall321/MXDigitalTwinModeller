# MXDigitalTwinModeller 프로젝트 개발 계획서

## 1. 프로젝트 개요

### 1.1 목적
SpaceClaim 기반 ASTM 규격 인장시험 시편 자동 모델링 AddIn 개발

### 1.2 주요 기능
- ASTM 규격 인장시험 시편 자동 생성 (ASTM E8, ASTM D638 등)
- 직관적인 파라메트릭 대화창을 통한 치수 입력
- 확장 가능한 구조로 향후 다양한 시편 및 모델링 기능 추가 가능

---

## 2. SampleAddIn 프로젝트 분석 결과

### 2.1 핵심 구조
```
SampleAddIn/
├─ AddIn.cs                          # Main AddIn 클래스 (IExtensibility, ICommandExtensibility, IRibbonExtensibility 구현)
├─ SampleAddIn.Manifest.xml          # AddIn 등록 파일
├─ SampleAddIn.csproj                # 프로젝트 파일
├─ Commands/
│  ├─ Base/
│  │  └─ BaseCommandCapsule.cs      # 커맨드 기본 클래스
│  ├─ CreateBlock.cs                 # 블록 생성 커맨드 예제
│  ├─ CreateGear.cs                  # 기어 생성 커맨드 예제
│  └─ ...
├─ UI Extensions/
│  ├─ BananaOptionsPageControl.cs    # UserControl 기반 대화창 예제
│  └─ ...
├─ Resources/
│  ├─ Ribbon.xml                     # 리본 UI 정의
│  └─ *.png                          # 아이콘 이미지
└─ Properties/
   ├─ AssemblyInfo.cs
   ├─ Resources.resx                 # 리소스 문자열
   └─ Settings.settings              # 설정 저장
```

### 2.2 주요 패턴

#### AddIn 등록
- **Manifest.xml**: AddIn 이름, 설명, 어셈블리, 타입명, 호스팅 모드 정의
- **출력 경로**: `C:\ProgramData\SpaceClaim\AddIns\` 폴더로 빌드

#### Command Capsule 패턴
```csharp
class MyCommandCapsule : BaseCommandCapsule {
    public const string CommandName = "MyAddIn.MyCommand";

    // OnUpdate: 활성화 조건
    protected override void OnUpdate(Command command) {
        command.IsEnabled = Window.ActiveWindow != null;
    }

    // OnExecute: 실행 로직
    protected override void OnExecute(Command command, ExecutionContext context, Rectangle buttonRect) {
        // 모델링 로직
    }
}
```

#### 모델링 API
- `Body.ExtrudeProfile()`: 프로파일 압출
- `DesignBody.Create()`: 디자인 바디 생성
- `Part`, `Window`, `Document` 관리

#### Ribbon UI
- XML로 탭, 그룹, 버튼 정의
- Command 이름과 매핑

---

## 3. MXDigitalTwinModeller 프로젝트 구조 설계

### 3.1 프로젝트 구조
```
MXDigitalTwinModeller/
├─ .env                              # 환경 변수 파일 (SpaceClaim 경로 등)
├─ MXDigitalTwinModeller.csproj      # 프로젝트 파일
├─ MXDigitalTwinModeller.Manifest.xml
├─ AddIn.cs                          # Main AddIn 클래스
│
├─ Core/                             # 공통 기능 모듈
│  ├─ Geometry/
│  │  ├─ ProfileBuilder.cs          # 프로파일 생성 헬퍼
│  │  ├─ BodyBuilder.cs             # 바디 생성 헬퍼
│  │  └─ GeometryUtils.cs           # 기하학 유틸리티
│  ├─ Commands/
│  │  └─ BaseCommandCapsule.cs      # 커맨드 기본 클래스
│  └─ UI/
│     ├─ BaseDialogForm.cs          # 대화창 기본 클래스
│     └─ ValidationHelper.cs        # 입력 검증 헬퍼
│
├─ Commands/                         # 커맨드 구현
│  └─ TensileTest/
│     └─ CreateASTMTensileSpecimenCommand.cs
│
├─ UI/                               # 대화창 UI
│  └─ Dialogs/
│     └─ TensileSpecimenDialog.cs   # ASTM 인장시편 대화창
│     └─ TensileSpecimenDialog.Designer.cs
│     └─ TensileSpecimenDialog.resx
│
├─ Models/                           # 데이터 모델
│  └─ TensileTest/
│     ├─ ASTMSpecimenType.cs        # ASTM 규격 Enum
│     └─ TensileSpecimenParameters.cs # 시편 파라미터 클래스
│
├─ Services/                         # 비즈니스 로직
│  └─ TensileTest/
│     ├─ ASTMSpecimenFactory.cs     # 시편 생성 팩토리
│     └─ SpecimenModelingService.cs # 모델링 서비스
│
├─ Resources/
│  ├─ Ribbon.xml
│  ├─ Icons/
│  │  └─ TensileTest.png
│  └─ Strings.resx                  # 다국어 리소스
│
└─ Properties/
   ├─ AssemblyInfo.cs
   └─ Settings.settings
```

### 3.2 모듈 설명

#### Core 모듈 (재사용 가능한 공통 기능)
- **Geometry**: 기하학 생성 헬퍼 클래스들
  - `ProfileBuilder`: 프로파일 생성을 위한 유틸리티 (직선, 호, 원 등)
  - `BodyBuilder`: 바디 생성 및 조작 유틸리티
  - `GeometryUtils`: 좌표 변환, 단위 변환 등
- **Commands**: 커맨드 기본 클래스
- **UI**: 대화창 기본 클래스 및 검증 로직

#### Models (데이터 모델)
```csharp
public enum ASTMSpecimenType {
    ASTM_E8_Standard,      // 금속 평판 시편
    ASTM_E8_SubSize,       // 금속 서브사이즈
    ASTM_D638_TypeI,       // 플라스틱 Type I
    ASTM_D638_TypeII,      // 플라스틱 Type II
    // ... 확장 가능
}

public class TensileSpecimenParameters {
    public ASTMSpecimenType SpecimenType { get; set; }
    public double GaugeLength { get; set; }      // 게이지 길이
    public double GaugeWidth { get; set; }       // 게이지 폭
    public double Thickness { get; set; }        // 두께
    public double GripWidth { get; set; }        // 그립 폭
    public double TotalLength { get; set; }      // 전체 길이
    public double FilletRadius { get; set; }     // 필렛 반경
    // ... 기타 파라미터
}
```

#### Services (비즈니스 로직)
- **ASTMSpecimenFactory**: 규격별 기본 치수 제공
- **SpecimenModelingService**: SpaceClaim API를 사용한 실제 모델링 로직

#### UI (대화창)
```csharp
public class TensileSpecimenDialog : BaseDialogForm {
    // ComboBox: ASTM 규격 선택
    // NumericUpDown: 치수 입력
    // Button: 프리셋 로드, 생성, 취소
    // PictureBox: 시편 형상 미리보기 이미지
}
```

---

## 4. 개발 단계

### Phase 1: 프로젝트 초기 설정
1. **프로젝트 생성**
   - Visual Studio 2022에서 Class Library (.NET Framework 4.7.2) 프로젝트 생성
   - 프로젝트 이름: `MXDigitalTwinModeller`

2. **.env 파일 설정**
   - `.env` 파일 생성 (Git 제외)
   - SpaceClaim 설치 경로 및 출력 경로 정의
   ```
   SPACECLAIM_INSTALL_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim
   SPACECLAIM_API_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim\Api\V251\bin\x64\Debug
   ADDIN_OUTPUT_PATH=C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller
   ```

3. **.csproj 설정**
   - SpaceClaim.Api.V251.dll 참조 추가 (환경변수 사용)
   - 출력 경로를 .env에서 읽도록 설정 (MSBuild 확장)
   - Debug 시 SpaceClaim 실행 설정

4. **Manifest.xml 생성**
   ```xml
   <AddIns>
     <AddIn name="MX Digital Twin Modeller"
            description="ASTM 규격 시편 및 모델링 자동화 도구"
            assembly="MXDigitalTwinModeller.dll"
            typename="MXDigitalTwinModeller.MXAddIn"
            host="SameAppDomain"/>
   </AddIns>
   ```

5. **빌드 후 이벤트 설정**
   - Manifest.xml 복사
   - 리소스 파일 복사

### Phase 2: 핵심 인프라 구축
6. **Core 모듈 개발**
   - `Core.Commands.BaseCommandCapsule` 구현
   - `Core.UI.BaseDialogForm` 구현
   - `Core.Geometry.ProfileBuilder` 구현
   - `Core.Geometry.BodyBuilder` 구현

7. **AddIn 메인 클래스**
   - `AddIn.cs` 생성
   - IExtensibility, ICommandExtensibility, IRibbonExtensibility 구현
   - 커맨드 등록 구조 구축

### Phase 3: ASTM 인장시편 기능 구현
8. **데이터 모델 정의**
   - `ASTMSpecimenType` Enum 정의
   - `TensileSpecimenParameters` 클래스 구현

9. **서비스 레이어 구현**
   - `ASTMSpecimenFactory`: 규격별 기본값 제공
   - `SpecimenModelingService`: 모델링 로직 구현
     - ASTM E8 Standard 시편 생성 로직
     - ASTM D638 Type I 시편 생성 로직

10. **대화창 UI 개발**
    - `TensileSpecimenDialog` 폼 디자인
      - ComboBox: 규격 선택
      - GroupBox: 치수 입력 그룹
      - NumericUpDown: 각 치수 입력
      - Button: "기본값 로드", "생성", "취소"
      - PictureBox: 시편 형상 참고 이미지
    - 입력 검증 로직
    - 파라미터 바인딩

11. **Command 구현**
    - `CreateASTMTensileSpecimenCommand` 구현
    - OnExecute에서 대화창 표시
    - 대화창 결과로 모델링 실행

12. **Ribbon UI 정의**
    - `Ribbon.xml` 작성
      - "MX Modeller" 탭 추가
      - "Tensile Test" 그룹 추가
      - "Create ASTM Specimen" 버튼 추가
    - 아이콘 이미지 준비

### Phase 4: 테스트 및 디버깅
13. **디버깅 설정**
    - Launch.json 설정 (SpaceClaim.exe 실행)
    - 중단점 테스트

14. **기능 테스트**
    - ASTM E8 시편 생성 테스트
    - ASTM D638 시편 생성 테스트
    - 치수 변경 테스트
    - 예외 처리 테스트

### Phase 5: 문서화 및 배포
15. **README 작성**
    - 설치 방법
    - 사용 방법
    - 개발 환경 설정 방법

16. **코드 주석 및 문서**
    - XML 문서 주석 추가
    - 아키텍처 다이어그램

---

## 5. ASTM 인장시편 상세 설계

### 5.1 ASTM E8 Standard 시편 (금속)
```
형상: 평판 인장시편
주요 치수:
- Gauge Length (GL): 50 mm
- Gauge Width (W): 12.5 mm
- Grip Width: 20 mm
- Total Length: 200 mm
- Fillet Radius: 12.5 mm
- Thickness: 사용자 입력
```

### 5.2 ASTM D638 Type I 시편 (플라스틱)
```
형상: 덤벨 형태
주요 치수:
- Gauge Length: 50 mm
- Gauge Width: 13 mm
- Grip Width: 19 mm
- Total Length: 165 mm
- Fillet Radius: 76 mm
- Thickness: 3.2 mm (기본값, 조정 가능)
```

### 5.3 모델링 알고리즘
1. **프로파일 생성**
   - 2D 스케치 생성 (대칭 활용)
   - 중심선 기준 대칭 프로파일
   - 호(Arc)와 직선(Line)으로 윤곽 구성

2. **3D 변환**
   - `Body.ExtrudeProfile()` 사용
   - 두께만큼 압출

3. **DesignBody 생성**
   - `DesignBody.Create()` 사용
   - 이름 자동 지정 (예: "ASTM E8 Standard Specimen")

---

## 6. 환경 설정 (.env) 통합

### 6.1 .env 파일 구조
```ini
# SpaceClaim 설치 경로
SPACECLAIM_INSTALL_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim

# SpaceClaim API DLL 경로
SPACECLAIM_API_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim\Api\V251\bin\x64\Debug

# AddIn 출력 경로
ADDIN_OUTPUT_PATH=C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller

# 디버그 실행 파일
SPACECLAIM_EXE=C:\Program Files\ANSYS Inc\v251\SpaceClaim\SpaceClaim.exe
```

### 6.2 .csproj에서 .env 사용
- DotNetEnv NuGet 패키지 사용 또는
- MSBuild 확장 사용하여 환경변수 로드
- HintPath를 환경변수로 설정

**Directory.Build.props 파일 생성:**
```xml
<Project>
  <PropertyGroup>
    <SpaceClaimApiPath Condition="'$(SpaceClaimApiPath)' == ''">$(SPACECLAIM_API_PATH)</SpaceClaimApiPath>
    <AddInOutputPath Condition="'$(AddInOutputPath)' == ''">$(ADDIN_OUTPUT_PATH)</AddInOutputPath>
  </PropertyGroup>
</Project>
```

### 6.3 launchSettings.json (디버깅)
```json
{
  "profiles": {
    "SpaceClaim Debug": {
      "commandName": "Executable",
      "executablePath": "C:\\Program Files\\ANSYS Inc\\v251\\SpaceClaim\\SpaceClaim.exe",
      "commandLineArgs": ""
    }
  }
}
```

---

## 7. 클래스 설계 예시

### 7.1 TensileSpecimenDialog (직관적 설계)
```csharp
public partial class TensileSpecimenDialog : BaseDialogForm
{
    // Properties
    public TensileSpecimenParameters Parameters { get; private set; }

    // Constructor
    public TensileSpecimenDialog()
    {
        InitializeComponent();
        InitializeSpecimenTypes();
        Parameters = new TensileSpecimenParameters();
    }

    // Methods
    private void InitializeSpecimenTypes()
    {
        cmbSpecimenType.Items.Add("ASTM E8 - Standard (Metal)");
        cmbSpecimenType.Items.Add("ASTM E8 - SubSize (Metal)");
        cmbSpecimenType.Items.Add("ASTM D638 - Type I (Plastic)");
        cmbSpecimenType.Items.Add("ASTM D638 - Type II (Plastic)");
        cmbSpecimenType.SelectedIndex = 0;
    }

    private void btnLoadDefaults_Click(object sender, EventArgs e)
    {
        var factory = new ASTMSpecimenFactory();
        Parameters = factory.GetDefaultParameters(GetSelectedSpecimenType());
        BindParametersToUI();
    }

    private void btnCreate_Click(object sender, EventArgs e)
    {
        if (ValidateInputs())
        {
            ReadParametersFromUI();
            DialogResult = DialogResult.OK;
            Close();
        }
    }

    private bool ValidateInputs()
    {
        // 입력 검증 로직
        if (numGaugeLength.Value <= 0)
        {
            MessageBox.Show("Gauge Length must be greater than 0");
            return false;
        }
        // ... 추가 검증
        return true;
    }

    private void BindParametersToUI() { /* ... */ }
    private void ReadParametersFromUI() { /* ... */ }
    private ASTMSpecimenType GetSelectedSpecimenType() { /* ... */ }
}
```

### 7.2 SpecimenModelingService (모델링 로직)
```csharp
public class SpecimenModelingService
{
    private readonly ProfileBuilder _profileBuilder;
    private readonly BodyBuilder _bodyBuilder;

    public SpecimenModelingService()
    {
        _profileBuilder = new ProfileBuilder();
        _bodyBuilder = new BodyBuilder();
    }

    public DesignBody CreateTensileSpecimen(Part part, TensileSpecimenParameters parameters)
    {
        switch (parameters.SpecimenType)
        {
            case ASTMSpecimenType.ASTM_E8_Standard:
                return CreateASTM_E8_Standard(part, parameters);

            case ASTMSpecimenType.ASTM_D638_TypeI:
                return CreateASTM_D638_TypeI(part, parameters);

            default:
                throw new NotSupportedException($"Specimen type {parameters.SpecimenType} is not supported");
        }
    }

    private DesignBody CreateASTM_E8_Standard(Part part, TensileSpecimenParameters p)
    {
        // 1. 프로파일 생성
        var profile = CreateE8Profile(p);

        // 2. 압출
        var body = Body.ExtrudeProfile(profile, p.Thickness);

        // 3. DesignBody 생성
        return DesignBody.Create(part, "ASTM E8 Standard Specimen", body);
    }

    private Profile CreateE8Profile(TensileSpecimenParameters p)
    {
        var curves = new List<ITrimmedCurve>();

        // 중심선 기준 대칭 프로파일 생성
        // ... ProfileBuilder를 사용한 프로파일 생성 로직

        return new Profile(Plane.PlaneXY, curves);
    }

    // ... 다른 규격 구현
}
```

---

## 8. 개발 우선순위

### 높음 (MVP - Minimum Viable Product)
1. 프로젝트 초기 설정 (.env, .csproj, Manifest)
2. Core 모듈 기본 구조
3. ASTM E8 Standard 시편 1개 구현
4. 간단한 대화창 (치수 입력만)
5. 디버깅 환경 설정

### 중간 (기능 확장)
6. ASTM D638 Type I 추가
7. 대화창 UI 개선 (기본값 로드, 미리보기 이미지)
8. 입력 검증 강화
9. 에러 처리 및 사용자 피드백

### 낮음 (추가 기능)
10. 다양한 ASTM 규격 추가
11. 시편 치수 프리셋 저장/로드
12. 3D 미리보기 (선택사항)
13. 다국어 지원
14. 단위 변환 (mm, inch)

---

## 9. 개발 체크리스트

### 환경 설정
- [ ] Visual Studio 2022 설치 확인
- [ ] SpaceClaim V251 설치 확인
- [ ] .env 파일 생성 및 경로 설정
- [ ] .gitignore에 .env 추가
- [ ] 프로젝트 생성

### 프로젝트 구조
- [ ] Directory.Build.props 생성
- [ ] .csproj 설정 (참조, 출력 경로)
- [ ] Manifest.xml 생성
- [ ] 폴더 구조 생성 (Core, Commands, UI, Models, Services)

### Core 모듈
- [ ] BaseCommandCapsule 구현
- [ ] BaseDialogForm 구현
- [ ] ProfileBuilder 구현
- [ ] BodyBuilder 구현
- [ ] ValidationHelper 구현

### AddIn 메인
- [ ] AddIn.cs 구현
- [ ] Ribbon.xml 작성
- [ ] 아이콘 준비

### ASTM 인장시편
- [ ] ASTMSpecimenType Enum
- [ ] TensileSpecimenParameters 클래스
- [ ] ASTMSpecimenFactory 구현
- [ ] SpecimenModelingService 구현 (ASTM E8)
- [ ] TensileSpecimenDialog 폼 디자인
- [ ] TensileSpecimenDialog 로직 구현
- [ ] CreateASTMTensileSpecimenCommand 구현

### 테스트 및 디버깅
- [ ] 디버깅 설정 (launchSettings.json)
- [ ] SpaceClaim에서 AddIn 로드 확인
- [ ] 리본 UI 표시 확인
- [ ] 대화창 표시 확인
- [ ] ASTM E8 시편 생성 테스트
- [ ] 치수 변경 테스트

### 문서화
- [ ] README.md 작성
- [ ] 코드 주석 추가
- [ ] 개발 가이드 작성

---

## 10. 참고 자료

### ASTM 규격 문서
- ASTM E8/E8M: Standard Test Methods for Tension Testing of Metallic Materials
- ASTM D638: Standard Test Method for Tensile Properties of Plastics

### SpaceClaim API
- SpaceClaim API Documentation (V251)
- SampleAddIn 프로젝트 참조

### 개발 도구
- Visual Studio 2022
- .NET Framework 4.7.2
- Git

---

## 11. 리스크 및 대응 방안

### 리스크 1: SpaceClaim API 참조 경로 문제
- **대응**: .env 파일로 경로 관리, 팀원 간 경로 공유

### 리스크 2: 복잡한 기하학 생성 어려움
- **대응**: ProfileBuilder, BodyBuilder로 추상화, 단계별 검증

### 리스크 3: 디버깅 어려움
- **대응**: 충분한 로깅, 예외 처리, 단위 테스트

### 리스크 4: 확장성 부족
- **대응**: 모듈화된 구조, 인터페이스 기반 설계, 팩토리 패턴 사용

---

## 12. 다음 단계

1. **프로젝트 초기 설정 시작**
   - Visual Studio에서 새 프로젝트 생성
   - .env 파일 및 .gitignore 설정
   - Directory.Build.props 작성

2. **기본 구조 구축**
   - AddIn.cs 뼈대 작성
   - Manifest.xml 작성
   - 빌드 및 SpaceClaim 로드 테스트

3. **첫 번째 기능 구현**
   - ASTM E8 Standard 시편 모델링 로직 구현
   - 간단한 대화창 구현
   - 엔드투엔드 테스트

---

**작성일**: 2026-02-01
**작성자**: Claude (AI Assistant)
**프로젝트명**: MXDigitalTwinModeller
**버전**: 1.0
