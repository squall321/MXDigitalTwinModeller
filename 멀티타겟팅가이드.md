# MXDigitalTwinModeller 멀티타겟팅 가이드

## 개요

이 프로젝트는 **SpaceClaim V251과 V252 모두를 지원**하는 멀티타겟팅으로 구성되었습니다.

## 멀티타겟팅 구조

### 1. 빌드 구성 (Build Configurations)

프로젝트에는 4가지 빌드 구성이 있습니다:

| 구성 | 버전 | 타입 | 출력 경로 |
|------|------|------|-----------|
| Debug-V251 | V251 | Debug | `C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V251` |
| Release-V251 | V251 | Release | `C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V251` |
| Debug-V252 | V252 | Debug | `C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V252` |
| Release-V252 | V252 | Release | `C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V252` |

### 2. 조건부 컴파일 심볼

각 빌드 구성은 자동으로 조건부 컴파일 심볼을 정의합니다:

- **V251 빌드**: `V251` 심볼 정의
- **V252 빌드**: `V252` 심볼 정의

### 3. 소스 코드 조건부 컴파일

모든 SpaceClaim API 참조는 조건부 컴파일을 사용합니다:

```csharp
#if V251
using SpaceClaim.Api.V251.Extensibility;
using SpaceClaim.Api.V251.Geometry;
#elif V252
using SpaceClaim.Api.V252.Extensibility;
using SpaceClaim.Api.V252.Geometry;
#endif
```

## 사용 방법

### Visual Studio에서 빌드하기

1. **빌드 구성 선택**
   - Visual Studio 상단의 구성 드롭다운에서 원하는 구성 선택
   - 예: `Debug-V252`

2. **빌드 실행**
   - `Ctrl+Shift+B` 또는 메뉴에서 "빌드 > 솔루션 빌드"

3. **출력 확인**
   - 빌드 출력 창에 다음과 같이 표시됩니다:
     ```
     Building for SpaceClaim V252
     Output: C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V252
     ```

### 디버깅하기

1. **빌드 구성 선택**
   - 예: `Debug-V252`

2. **디버그 프로파일 선택**
   - Visual Studio에서 디버그 시작 버튼 옆 드롭다운 클릭
   - `SpaceClaim V252 Debug` 선택

3. **디버깅 시작**
   - `F5` 키 또는 "디버그 시작" 버튼 클릭
   - 해당 버전의 SpaceClaim이 실행됩니다

### 양쪽 버전 모두 빌드하기

양쪽 버전을 모두 사용하려면:

1. `Debug-V251` 구성으로 빌드
2. `Debug-V252` 구성으로 빌드

각 버전의 AddIn이 별도 폴더에 생성됩니다.

## 환경 변수 설정

`.env` 파일에서 각 버전의 경로를 설정합니다:

```ini
# V251 경로
SPACECLAIM_V251_INSTALL_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim
SPACECLAIM_V251_API_PATH=C:\Program Files\ANSYS Inc\v251\SpaceClaim\Api\V251\bin\x64\Debug
SPACECLAIM_V251_EXE=C:\Program Files\ANSYS Inc\v251\SpaceClaim\SpaceClaim.exe

# V252 경로
SPACECLAIM_V252_INSTALL_PATH=C:\Program Files\ANSYS Inc\v252\SpaceClaim
SPACECLAIM_V252_API_PATH=C:\Program Files\ANSYS Inc\v252\SpaceClaim\Api\V252\bin\x64\Debug
SPACECLAIM_V252_EXE=C:\Program Files\ANSYS Inc\v252\SpaceClaim\SpaceClaim.exe

# 출력 경로
ADDIN_OUTPUT_PATH_V251=C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V251
ADDIN_OUTPUT_PATH_V252=C:\ProgramData\SpaceClaim\AddIns\MXDigitalTwinModeller\V252
```

## 파일 구조

```
MXDigitalTwinModeller/
├─ .env                              # 환경 변수 (버전별 경로)
├─ Directory.Build.props             # MSBuild 멀티타겟팅 설정
├─ MXDigitalTwinModeller.csproj      # 4가지 빌드 구성
│
├─ Core/
│  ├─ Commands/
│  │  └─ BaseCommandCapsule.cs      # #if V251 / #elif V252
│  └─ Geometry/
│     ├─ ProfileBuilder.cs           # #if V251 / #elif V252
│     ├─ BodyBuilder.cs              # #if V251 / #elif V252
│     └─ GeometryUtils.cs            # #if V251 / #elif V252
│
├─ Services/
│  └─ TensileTest/
│     └─ SpecimenModelingService.cs # #if V251 / #elif V252
│
├─ Commands/
│  └─ TensileTest/
│     └─ CreateASTMTensileSpecimenCommand.cs # #if V251 / #elif V252
│
└─ AddIn.cs                          # #if V251 / #elif V252
```

## MSBuild 동작 방식

### Directory.Build.props

빌드 구성에서 버전을 자동으로 추출합니다:

```xml
<!-- 빌드 구성에서 버전 추출 -->
<SpaceClaimVersion Condition="$(Configuration.Contains('V251'))">V251</SpaceClaimVersion>
<SpaceClaimVersion Condition="$(Configuration.Contains('V252'))">V252</SpaceClaimVersion>

<!-- 현재 버전에 맞는 경로 선택 -->
<SpaceClaimApiPath Condition="'$(SpaceClaimVersion)' == 'V251'">$(SpaceClaimApiPath_V251)</SpaceClaimApiPath>
<SpaceClaimApiPath Condition="'$(SpaceClaimVersion)' == 'V252'">$(SpaceClaimApiPath_V252)</SpaceClaimApiPath>
```

### .csproj 파일

조건부로 DLL을 참조합니다:

```xml
<!-- V251 빌드 시 -->
<ItemGroup Condition=" $(Configuration.Contains('V251')) ">
  <Reference Include="SpaceClaim.Api.V251">
    <HintPath>$(SpaceClaimApiPath_V251)\SpaceClaim.Api.V251.dll</HintPath>
  </Reference>
</ItemGroup>

<!-- V252 빌드 시 -->
<ItemGroup Condition=" $(Configuration.Contains('V252')) ">
  <Reference Include="SpaceClaim.Api.V252">
    <HintPath>$(SpaceClaimApiPath_V252)\SpaceClaim.Api.V252.dll</HintPath>
  </Reference>
</ItemGroup>
```

## 새 버전 추가하기

향후 V253이 출시되면 다음과 같이 추가할 수 있습니다:

1. **.env 파일에 V253 경로 추가**
2. **Directory.Build.props에 V253 경로 추가**
3. **.csproj에 Debug-V253, Release-V253 구성 추가**
4. **소스 코드에 `#elif V253` 추가**
5. **launchSettings.json에 V253 프로파일 추가**

## 트러블슈팅

### 문제: 빌드 시 DLL을 찾을 수 없음

**해결**:
1. `.env` 파일의 경로가 올바른지 확인
2. SpaceClaim이 해당 버전으로 설치되어 있는지 확인
3. Visual Studio를 재시작하여 환경 변수 다시 로드

### 문제: 잘못된 버전의 SpaceClaim이 실행됨

**해결**:
1. 빌드 구성과 디버그 프로파일이 일치하는지 확인
   - Debug-V251 → SpaceClaim V251 Debug
   - Debug-V252 → SpaceClaim V252 Debug

### 문제: 네임스페이스 오류

**해결**:
1. 조건부 컴파일 심볼이 제대로 정의되었는지 확인
2. 프로젝트를 Clean 후 Rebuild

## 장점

### 1. 단일 코드베이스
- 하나의 소스 코드로 두 버전 모두 지원
- 유지보수 편리

### 2. 자동 버전 선택
- 빌드 구성만 바꾸면 자동으로 올바른 DLL 참조
- 수동 설정 불필요

### 3. 독립적인 출력
- 각 버전이 별도 폴더에 빌드
- 양쪽 버전을 동시에 설치 가능

### 4. 확장 가능
- 새 버전 추가가 쉬움
- 패턴이 일관됨

## 요약

이 멀티타겟팅 설정으로:
- ✅ V251과 V252를 동시에 지원
- ✅ 빌드 구성만 바꾸면 자동으로 버전 전환
- ✅ 각 버전에 맞는 DLL 자동 참조
- ✅ 독립적인 출력 경로
- ✅ 향후 버전 추가 용이

**기본 사용법**: `Debug-V252` 구성 선택 → F5로 디버깅
